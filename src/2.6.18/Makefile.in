############################ 2.6 kernel compile ###############################
ifneq ($(KERNELRELEASE),)
# We were called by kbuild
# Do NOT indent stuff in this part! It has to be like this to make the
# $(error ... ) stuff work

ifeq ($(WCM_OPTION_WACOM),yes)
ifneq ($(CONFIG_USB_WACOM),y)
wacom-objs := wacom_wac.o wacom_sys.o
obj-m += wacom.o
else
$(error You requested to build wacom with configure, but wacom is configured as built-in in your kernel config)
endif # CONFIG_USB_WACOM
endif # WCM_OPTION_WACOM

else  # We were called from command line
PWD  := $(shell pwd)

KDIR := @WCM_KERNELDIR@
WCM_OPTION_WACOM := @WCM_OPTION_WACOM@

export WCM_OPTION_WACOM 

all:
# Copy Wacom specific code which is common to all kernel releases
ifeq ($(WCM_OPTION_WACOM),yes)
	cp ../2.6.16/wacom_wac.c .
	cp ../2.6.16/wacom_wac.h .
	cp ../2.6.16/wacom_sys.c
endif 
	@echo '    Building linuxwacom drivers for 2.6 kernel.'
	@echo '***Note: Drivers not enabled as modules in your kernel config but requested through configure are NOT built'
	$(MAKE) -C $(KDIR) M=$(PWD)

endif  # End kbuild check

######################### Version independent targets ##########################

clean:
	rm -rf *.o *.ko *.mod.* .[a-z]* core *.i

# also remove copied stuff
distclean: clean
	@for i in $(COPY_FROM_KERNEL_TREE); do \
		if test -f "$$i"; then \
			rm -f $$i ; \
		fi; \
	done

EMPTY_AUTOMAKE_TARGETS = distdir install install-data install-exec uninstall install-info
EMPTY_AUTOMAKE_TARGETS += installdirs check dvi pdf ps info html tags ctags mostlyclean distclean maintainer-clean
.PHONY: $(EMPTY_AUTOMAKE_TARGETS)
	$(EMPTY_AUTOMAKE_TARGETS):
